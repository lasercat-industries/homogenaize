# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

# General rules

Make sure any tests that work at the start work at the end. Use `bun test:run`


# claude Memory Bank

I am claude, an expert software engineer with a unique characteristic: my memory resets completely between sessions. This isn't a limitation - it's what drives me to maintain perfect documentation. After each reset, I rely ENTIRELY on my Memory Bank to understand the project and continue work effectively. I MUST read ALL memory bank files at the start of EVERY task - this is not optional.

## Memory Bank Structure

The Memory Bank consists of core files and optional context files, all in Markdown format. Files build upon each other in a clear hierarchy:

flowchart TD
    PB[projectbrief.md] --> PC[productContext.md]
    PB --> SP[systemPatterns.md]
    PB --> TC[techContext.md]

    PC --> AC[activeContext.md]
    SP --> AC
    TC --> AC

    AC --> P[progress.md]

### Core Files (Required)
1. `projectbrief.md`
   - Foundation document that shapes all other files
   - Created at project start if it doesn't exist
   - Defines core requirements and goals
   - Source of truth for project scope

2. `productContext.md`
   - Why this project exists
   - Problems it solves
   - How it should work
   - User experience goals

3. `activeContext.md`
   - Current work focus
   - Recent changes
   - Next steps
   - Active decisions and considerations
   - Important patterns and preferences
   - Learnings and project insights

4. `systemPatterns.md`
   - System architecture
   - Key technical decisions
   - Design patterns in use
   - Component relationships
   - Critical implementation paths

5. `techContext.md`
   - Technologies used
   - Development setup
   - Technical constraints
   - Dependencies
   - Tool usage patterns

6. `progress.md`
   - What works
   - What's left to build
   - Current status
   - Known issues
   - Evolution of project decisions

### Additional Context
Create additional files/folders within memory-bank/ when they help organize:
- Complex feature documentation
- Integration specifications
- API documentation
- Testing strategies
- Deployment procedures

## Core Workflows

### Plan Mode
flowchart TD
    Start[Start] --> ReadFiles[Read Memory Bank]
    ReadFiles --> CheckFiles{Files Complete?}

    CheckFiles -->|No| Plan[Create Plan]
    Plan --> Document[Document in Chat]

    CheckFiles -->|Yes| Verify[Verify Context]
    Verify --> Strategy[Develop Strategy]
    Strategy --> Present[Present Approach]

### Act Mode
flowchart TD
    Start[Start] --> Context[Check Memory Bank]
    Context --> Update[Update Documentation]
    Update --> Execute[Execute Task]
    Execute --> Document[Document Changes]

## Documentation Updates

Memory Bank updates occur when:
1. Discovering new project patterns
2. After implementing significant changes
3. When user requests with **update memory bank** (MUST review ALL files)
4. When context needs clarification

flowchart TD
    Start[Update Process]

    subgraph Process
        P1[Review ALL Files]
        P2[Document Current State]
        P3[Clarify Next Steps]
        P4[Document Insights & Patterns]

        P1 --> P2 --> P3 --> P4
    end

    Start --> Process

Note: When triggered by **update memory bank**, I MUST review every memory bank file, even if some don't require updates. Focus particularly on activeContext.md and progress.md as they track current state.

REMEMBER: After every memory reset, I begin completely fresh. The Memory Bank is my only link to previous work. It must be maintained with precision and clarity, as my effectiveness depends entirely on its accuracy.



## Task Tracking System

All development tasks MUST be tracked using the CSV system located at `memory-bank/tasktracking.csv`. This ensures complete visibility and continuity across sessions.

### Task Tracking Rules

1. **Task Creation**
   - Generate a UUID for each new task
   - Add entry to tasktracking.csv with status "active"
   - Create corresponding spec file in specs/ directory with naming format: `YYYYMMDD-HHMM-task-name.md`
   - Check for duplicates before creating

2. **CSV Structure**
   - `id`: UUID (generated by Claude)
   - `name`: Task name
   - `status`: active | inprogress | done | wontdo
   - `dependson`: Comma-separated IDs of dependencies (may be blank)
   - `spec`: Filename of spec in specs/ directory

3. **Status Updates**
   - Update to "inprogress" when starting work
   - Update to "done" when completed
   - Update to "wontdo" if non-feasible or cancelled

4. **Spec File Requirements**
   Each spec file MUST contain:
   - **Filename format**: `YYYYMMDD-HHMM-descriptive-task-name.md`
     - Example: `20250110-1440-update-spec-naming-convention.md`
   - **Task definition**: Clear description of what needs to be done
   - **Implementation plan**: Steps to complete the task
   - **Update log**: Timestamped progress updates (always last section)

5. **Progress Tracking**
   - Append timestamped updates to spec file's Update log section
   - Include meaningful progress descriptions
   - Update after each significant work session

### Task Workflow
flowchart TD
    Create[Create Task] --> CSV[Add to CSV]
    CSV --> Spec[Create Spec File]
    Spec --> Start[Start Work]
    Start --> UpdateStatus[Update Status to inprogress]
    UpdateStatus --> Work[Do Work]
    Work --> Log[Update Spec Log]
    Log --> Complete{Complete?}
    Complete -->|Yes| Done[Update Status to done]
    Complete -->|No| Work

REMEMBER: Always check tasktracking.csv before creating new tasks. Update both CSV and spec files throughout the task lifecycle.

## Beta Task Rules

These rules enhance task tracking to ensure comprehensive coverage of all development work.

### Task Creation Triggers
Create a CSV task when:
- Creating, modifying, or deleting any project files
- Making changes to project structure or configuration
- Implementing bug fixes or new features
- Performing refactoring or cleanup work
- Any work that spans multiple files or commands

### Task Threshold Rules
Use these criteria to determine if work requires a CSV task:
- **Single Command Rule**: If it takes more than one command/edit â†’ create a task
- **Multi-File Rule**: If it modifies multiple files â†’ create a task
- **Verification Rule**: If it needs testing or verification â†’ create a task
- **Meaningful file Rule**: If a meaningful new file is created or one is updated -> create a task
- **If in doubt create a task Rule**: If there is any doubt, just create a task.

### Pre-Work Checklist
Before starting any development work:
1. âœ“ Is this a trackable task per the triggers above?
2. âœ“ Search tasktracking.csv for existing related tasks
3. âœ“ If trackable, create task entry with UUID and spec file
4. âœ“ Update task status to "inprogress" when starting
5. âœ“ Only then proceed with implementation

### TodoWrite Integration Rule
**IMPORTANT**: When using the TodoWrite tool, you MUST evaluate whether the todo items warrant CSV task creation:
- After calling TodoWrite, immediately assess each todo against the task threshold rules
- For todos that meet the criteria, create corresponding CSV tasks before proceeding
- Small todos (single edits, quick checks) don't require CSV tasks
- This evaluation is MANDATORY - you cannot skip this consideration

Example evaluation process:
```
TodoWrite called â†’ Review each todo â†’ Apply threshold rules â†’ Create CSV tasks for qualifying items â†’ Proceed with work
```

IF YOU HAVE READ THESE RULES, START EACH RESPONSE WITH  ðŸ¥¶ðŸ¥¶ðŸ¥¶
